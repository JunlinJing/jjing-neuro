{% assign website_posts = site.categories.website | limit: 3 %}
{% assign personal_posts = site.posts | where_exp: "post", "post.categories contains 'personal'" | limit: 3 %}

<div class="news-grid" id="homepage-news-grid">
    <div class="news-column" data-category="other">
        <h4 class="column-title">Other Updates</h4>
        <div class="news-items">
            {% if website_posts.size > 0 %}
                {% for post in website_posts %}
                <div class="news-item">
                    <span class="date">{{ post.date | date: "%B %Y" }}</span>
                    <p>{{ post.excerpt | strip_html | truncatewords: 15 }}</p>
                    <div class="news-tag">{{ post.categories | first | capitalize }}</div>
                </div>
                {% endfor %}
            {% else %}
                <div class="news-item">
                    <span class="date">May 8, 2025</span>
                    <p>This academic website was created on May 8, 2025.</p>
                    <div class="news-tag">Site</div>
                </div>
                <div class="news-item">
                    <span class="date">March 2024</span>
                    <p>Started a new research project on deep learning applications in EEG signal processing.</p>
                    <div class="news-tag">Project</div>
                </div>
            {% endif %}
        </div>
    </div>
    <div class="news-column" data-category="personal">
        <h4 class="column-title">Personal Updates</h4>
        <div class="news-items">
            {% if personal_posts.size > 0 %}
                {% for post in personal_posts %}
                <div class="news-item">
                    <span class="date">{{ post.date | date: "%B %Y" }}</span>
                    <p>{{ post.excerpt | strip_html | truncatewords: 15 }}</p>
                    <div class="news-tag">{{ post.categories | first | capitalize }}</div>
                </div>
                {% endfor %}
            {% else %}
                <div class="news-item">
                    <span class="date">October 1, 2024</span>
                    <p>Joined Functional Neuroimaging Lab at LMU Munich</p>
                    <div class="news-tag">Personal</div>
                </div>
                <div class="news-item">
                    <span class="date">May 23, 2025</span>
                    <p>I will attend the event PhD Basics for International Doctoral Researchers at LMU Munich.</p>
                    <div class="news-tag">Personal</div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% if page.layout != 'news' %}
<script>
// This script only runs on the homepage and won't affect the news page
document.addEventListener('DOMContentLoaded', function() {
    // Check if there's new news data in localStorage
    const lastFetched = localStorage.getItem('news_last_fetched');
    const currentTime = new Date().getTime();
    
    // Refresh if data is over 1 hour old or doesn't exist
    if (!lastFetched || (currentTime - parseInt(lastFetched)) > 3600000) {
        // AJAX request can be added here to fetch latest news data
        // Since Jekyll is a static site, it actually needs to rebuild to update
        // This feature is mainly to provide better UX during user browsing
        
        // Update last fetch time
        localStorage.setItem('news_last_fetched', currentTime.toString());
    }
});
</script>
{% endif %} 